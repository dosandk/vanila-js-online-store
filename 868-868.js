"use strict";(self.webpackChunkvanila_js_online_store=self.webpackChunkvanila_js_online_store||[]).push([[868],{1:(t,e,s)=>{s.d(e,{Z:()=>d});var i=s(948),n=s(931),r=s(69),a=s(318),o=s(926);const l=(0,r.Z)((0,n.Z)(class{constructor(t={},e,s){var i,n,r;r={},(n="subElements")in(i=this)?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,this.product=t,this.store=e,this.observer=s,this.render(),this.initEventListeners()}get template(){const{images:t,rating:e,price:s,title:i,description:n}=this.product;return`\n      <div class="os-product-card">\n        <div class="os-product-img" style="background-image: url(${t[0].url});"></div>\n\n        <div class="os-product-content">\n          <div class="os-product-price-wrapper">\n            <div class="os-product-rating">\n              <span>${e}</span>\n              <i class="bi bi-star"></i>\n            </div>\n\n            <div class="os-product-price">${s} USD</div>\n          </div>\n\n          <h5 class="os-product-title">${i}</h5>\n          <p class="os-product-description">${n.slice(0,50)+"..."}</p>\n        </div>\n        ${this.footer}\n      </div>\n    `}get footer(){return'<footer class="os-product-footer">\n      <button class="os-btn-default add-to-wishlist-btn" data-element="addToWishlist">\n        <i class="bi bi-heart"></i>\n        <i class="bi bi-heart-fill"></i>\n        Wishlist\n      </button>\n\n      <button class="os-btn-primary add-to-cart-btn" data-element="addToCart">\n        <i class="bi bi-cart"></i>\n        <i class="bi bi-cart-check-fill"></i>\n        Cart\n      </button>\n    </footer>'}initEventListeners(){const{addToWishlist:t,addToCart:e}=this.subElements;t.addEventListener("pointerdown",(t=>{const e=t.currentTarget.classList.toggle("active");this.dispatchEvent("add-to-wishlist",{product:this.product,status:e}),this.store.dispatch((0,o.s3)(this.product))})),e.addEventListener("pointerdown",(t=>{const e=t.currentTarget.classList.toggle("active");this.dispatchEvent("add-to-wishlist",{product:this.product,status:e}),this.store.dispatch((0,a.gK)(this.product))}))}dispatchEvent(t="",e={}){this.observer.dispatchEvent({type:t,payload:e})}update(t={}){this.product=t,this.element.innerHTML=this.template}render(){this.element=(0,i.az)(this.template),this.subElements=(0,i.H)(this.element)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={}}}));class d{constructor(t=[]){this.data=t,this.render(),this.renderCards()}getTemplate(){return'\n      <div class="os-products-list" data-element="body">\n        \x3c!-- Cards list --\x3e\n      </div>\n    '}render(){const t=document.createElement("div");t.innerHTML=this.getTemplate(),this.element=t.firstElementChild}renderCards(){const t=this.getCardsList(this.data);this.element.innerHTML="",this.element.append(...t)}update(t=[]){this.data=t,this.renderCards()}getCardsList(t=[]){return t.map((t=>new l(t).element))}add(t){this.data=[...this.data,...t];const e=this.getCardsList(t);this.element.append(...e)}remove(){this.element&&this.element.remove()}}},587:(t,e,s)=>{s.d(e,{Z:()=>o});class i{static create(t="",e=""){return new{success:n,error:r,info:a}[t](e)}constructor(){var t,e,s;if(s=2e3,(e="duration")in(t=this)?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,new.target===i)throw new TypeError("Cannot construct Abstract instances directly")}get template(){}render(){const t=document.createElement("div");t.innerHTML=this.template,this.element=t.firstElementChild||t}show(t=document.body){t.append(this.element),this.timerId=setTimeout((()=>{this.remove()}),this.duration)}remove(){clearTimeout(this.timerId),this.element&&this.element.remove()}destroy(){this.remove()}}class n extends i{constructor(t=""){super(),this.message=t,this.render()}get template(){return`<div class="notification success" style="--value:${this.duration+"ms"}">\n      <div class="timer"></div>\n      <div class="inner-wrapper">\n        <div class="notification-body">\n          <i class="bi bi-check-circle"></i>\n          ${this.message}\n        </div>\n      </div>\n    </div>`}}class r extends i{constructor(t){super(),this.message=t,this.render(),this.addEventListeners()}get template(){return`<div class="notification error">\n      <div class="inner-wrapper">\n        <i class="bi bi-x close-btn" data-element="close"></i>\n        <div class="notification-body">\n          <i class="bi bi-exclamation-triangle"></i>\n          ${this.message}\n        </div>\n      </div>\n    </div>`}addEventListeners(){this.element.querySelector("[data-element='close']").addEventListener("click",(()=>{this.remove()}))}show(t=document.body){t.append(this.element)}}class a extends i{constructor(t=""){super(),this.message=t,this.render()}get template(){return`<div class="notification info" style="--value:${this.duration+"ms"}">\n      <div class="timer"></div>\n      <div class="inner-wrapper">\n        <div class="notification-body">\n          <i class="bi bi-info-circle"></i>\n          ${this.message}\n        </div>\n      </div>\n    </div>`}}class o{constructor({stackLimit:t=3}={}){var e,s,i;if(i=[],(s="notificationsList")in(e=this)?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i,o.instance)return o.instance;this.stackLimit=t,o.instance=this,this.render()}render(){this.element=document.createElement("div"),this.element.className="notifications-container",document.body.append(this.element)}show(t="",e=""){const s=i.create(e,t);s.show(this.element),this.notificationsList.length>=this.stackLimit&&this.removeOldMessage(),this.notificationsList.push(s)}removeOldMessage(){this.notificationsList.shift().remove()}destroy(){for(const t of this.notificationsList)t.destroy();this.notificationsList=[],o.instance=null}}},948:(t,e,s)=>{s.d(e,{H:()=>r,Oo:()=>a,SO:()=>l,az:()=>n,xg:()=>o});const i=globalThis.document,n=(t="")=>{const e=i.createElement("div");return e.innerHTML=t,e.firstElementChild||e},r=(t,e="[data-element]")=>{const s={},i=t.querySelectorAll(e);for(const t of i){s[t.dataset.element]=t}return s},a=(t,e="",s,i={})=>(t.addEventListener(e,s,i),()=>{t.removeEventListener(e,s,i)}),o=(t,e="",s,i={})=>{t.removeEventListener(e,s,i)},l={window:globalThis.window,document:globalThis.window.document,body:globalThis.window.document.body}},931:(t,e,s)=>{function i(t,e,s,i){return a(t,e),r(s,"set"),function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,s,i),i}function n(t,e,s){return a(t,e),r(s,"get"),function(t,e){if(e.get)return e.get.call(t);return e.value}(t,s)}function r(t,e){if(void 0===t)throw new TypeError("attempted to "+e+" private static field before its declaration")}function a(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}s.d(e,{Z:()=>d});class o{constructor(){var t,e,s;s={},(e="callbacks")in(t=this)?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}static get instance(){return n(o,o,l)||i(o,o,l,new o),n(o,o,l)}dispatchEvent(t){const{type:e,payload:s}=t,i=this.callbacks[e];if(i)for(const[t]of i.entries())t(s)}subscribe(t,e){return this.callbacks[t]?this.callbacks[t].set(e,null):this.callbacks[t]=new Map([[e,null]]),()=>this.callbacks[t].delete(e)}}var l={writable:!0,value:void 0};const d=t=>{var e,s,i,n;return s=e=class extends t{constructor(...t){t.push(o.instance),super(...t)}},i="name",n=`connected to observer ${t.name}`,i in s?Object.defineProperty(s,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[i]=n,e}},868:(t,e,s)=>{s.r(e),s.d(e,{default:()=>y});const i=(t,e=0)=>{let s;return function(...i){s&&clearTimeout(s),s=setTimeout((()=>{t.apply(this,i),s=null}),e)}};var n=s(931);function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const a=(0,n.Z)(class{constructor(t){r(this,"element",void 0),r(this,"subElements",{}),r(this,"delay",300),r(this,"onKeyUp",i((t=>{const e=t.target.value.trim();this.dispatchEvent(e)}),this.delay)),this.observer=t,this.initialize()}initialize(){this.render(),this.getSubElements(),this.addEventListeners()}get template(){return'\n      <form>\n        <div class="os-form-input use-icon">\n          <input id="search-input"\n            type="text"\n            data-element="search"\n            placeholder="Search">\n          <label class="bi bi-search input-icon"\n            for="search-input"></label>\n        </div>\n      </form>\n    '}render(){const t=document.createElement("div");t.innerHTML=this.template,this.element=t.firstElementChild}getSubElements(){const t={},e=this.element.querySelectorAll("[data-element]");for(const s of e){t[s.dataset.element]=s}this.subElements=t}dispatchEvent(t=""){this.observer.dispatchEvent({type:"search-filter",payload:t})}addEventListeners(){this.subElements.search.addEventListener("input",this.onKeyUp)}clear(){this.element.reset()}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={}}});var o=s(1),l=s(587),d=s(948);function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const h=(0,n.Z)(class{constructor(t={},{step:e=20}={},s){c(this,"loading",!1),c(this,"onWindowScroll",(()=>{const{bottom:t}=this.element.getBoundingClientRect();t-100<document.documentElement.clientHeight&&!this.loading&&(this.start=this.end,this.end=this.start+this.step,this.loading=!0,this.dispatchEvent("load-data",{start:this.start,end:this.end}))})),this.list=t,this.step=e,this.start=1,this.end=this.start+e,this.observer=s,this.initialize()}initialize(){this.render(),this.initEventListeners()}render(){this.element=(0,d.az)(),this.element.append(this.list.element)}add(t){this.list.add(t),this.loading=!1}update(t){this.list.update(t),this.loading=!1}resetPagination(){this.start=1,this.end=this.start+this.step}dispatchEvent(t="",e){this.observer.dispatchEvent({type:t,payload:e})}initEventListeners(){(0,d.Oo)(d.SO.document,"scroll",this.onWindowScroll)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.list=null,this.loading=!1,(0,d.xg)(d.SO.document,"scroll",this.onWindowScroll)}});function u(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class m{constructor(t,{data:e=[],sorted:s={id:t.find((t=>t.sortable)).id,order:"asc"}}={}){u(this,"element",void 0),u(this,"subElements",{}),u(this,"headersConfig",[]),u(this,"data",[]),u(this,"onSortClick",(t=>{const e=t.target.closest('[data-sortable="true"]');if(e){const t=this.element.querySelectorAll('[data-sortable="true"]'),{id:s,order:i}=e.dataset,n=(t=>({asc:"desc",desc:"asc"}[t]))(i)||"asc";t.forEach((t=>t.dataset.order="")),e.dataset.order=n,this.dispatchEvent(s,n)}})),this.headersConfig=t,this.data=e,this.sorted=s,this.initialize()}initialize(){this.render(),this.getSubElements(),this.initEventListeners()}getTableHeader(){return`<thead class="sortable-table-header" data-element="header">\n      <tr class="d-flex">\n        ${this.headersConfig.map((t=>this.getHeaderRow(t))).join("")}\n      </tr>\n    </thead>`}getHeaderRow({id:t,title:e,sortable:s}){return`\n      <th class="col" data-id="${t}" data-sortable="${s}" data-order="${this.sorted.id===t?this.sorted.order:""}">\n        <span>${e}</span>\n      </th>\n    `}getTableBody(t){return`<tbody data-element="body">\n      ${t.length?this.getTableRows(t):this.getEmptyPlaceholder()}\n    </tbody>`}getEmptyPlaceholder(){return`\n      <tr class="d-flex" data-element="emptyPlaceholder">\n        <td class="col text-center" colspan="${this.headersConfig.length}">No products</td>\n      </tr>`}getTableRows(t){const e=t=>this.headersConfig.map((({id:e,template:s})=>s?s(t[e]):`<td class="col">${t[e]}</td>`)).join("");return t.map(((t={})=>`\n      <tr class="d-flex">${e(t)}</tr>`)).join("")}getTable(t){return`<table class="table table-striped">\n      ${this.getTableHeader()}\n      ${this.getTableBody(t)}\n    </table>`}render(){const{id:t,order:e}=this.sorted,s=document.createElement("div"),i=this.sortData(t,e);s.innerHTML=this.getTable(i),this.element=s.firstElementChild}sortData(t,e){const s=[...this.data],i=this.headersConfig.find((e=>e.id===t)),{sortType:n}=i,r={asc:1,desc:-1}[e];return s.sort(((e,s)=>{switch(n){case"number":return r*(e[t]-s[t]);case"string":return r*e[t].localeCompare(s[t],["ru","en"])}}))}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onSortClick)}getSubElements(){const t={},e=this.element.querySelectorAll("[data-element]");for(const s of e){t[s.dataset.element]=s}this.subElements=t}update(t=[]){this.data=t,this.subElements.body.innerHTML=this.getTableBody(t)}add(t){const e=document.createElement("tbody");this.data=[...this.data,...t],e.innerHTML=this.getTableRows(t),this.subElements.body.append(...e.children)}dispatchEvent(t,e){}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element={},this.subElements={}}}const p={async request(t="",e={}){try{const s=await fetch(t,e);return await s.json()}catch(t){throw new b(t.message)}},async get(t="",e={}){return await this.request(t,e)},async post(t="",e={}){return await this.request(t,{type:"POST",...e})},async put(t="",e={}){return await this.request(t,{type:"PUT",...e})},async delete(t="",e={}){return await this.request(t,{type:"DELETE",...e})}};class b extends Error{constructor(t){var e,s,i;super(t),i="FetchError",(s="name")in(e=this)?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i}}window.addEventListener("unhandledrejection",(t=>{t.reason instanceof b&&console.error("Network error has occurred.")}));const v=p;var g=s(69);class f{constructor(t=""){this.url=new URL(t,"https://course-js.javascript.ru/api/rest/")}toString(){return this.url.toString()}addPagination(t,e){return this.url.searchParams.set("_start",t),this.url.searchParams.set("_end",e),this}addSort(t,e){return this.url.searchParams.set("_sort",t),this.url.searchParams.set("_order",e),this}addFilter(t,e){return this.url.searchParams.set("price_lte",t),this.url.searchParams.set("price_gte",e),this}addSearch(t){return this.url.searchParams.set("title_like",t),this}resetSearchParams(){const t=[...this.url.searchParams.keys()];for(const e of t)this.url.searchParams.delete(e);return this}}function E(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const y=(0,g.Z)((0,n.Z)(class{constructor(t,e,s){E(this,"subscriptions",[]),E(this,"subElements",[]),E(this,"components",{}),E(this,"pageSize",10),E(this,"products",[]),this.store=e,this.observer=s,this.url=new f("products"),this.initComponents(),this.render(),this.getSubElements(),this.renderComponents(),this.initEventListeners();const i=1+this.pageSize;this.url.addPagination(1,i),this.add(1,i)}async loadData(){return await v.get(this.url)}getTemplate(){return'\n      <div class="page-container">\n        <h1 class="page-title">Products</h1>\n\n        <div class="filters-panel">\n          <div data-element="search">\n            \x3c!-- Search component --\x3e\n          </div>\n          <div data-element="doubleSlider">\n            \x3c!-- DoubleSlider component --\x3e\n          </div>\n          <div class="list-view-controls">\n            <i class="bi bi-list" data-element="listBtn"></i>\n            <i class="bi bi-grid" data-element="gridBtn"></i>\n          </div>\n        </div>\n\n\n        <div data-element="list">\n          \x3c!-- Cards List component --\x3e\n        </div>\n      </div>\n    '}initComponents(){const t=new o.Z(this.products),e=new h(t,{step:this.pageSize}),s=new a;this.notificationManager=new l.Z({stackLimit:3}),this.components={list:e,search:s}}renderComponents(){for(const t of Object.keys(this.components)){const e=this.subElements[t],{element:s}=this.components[t];e.append(s)}}getSubElements(){const t={},e=this.element.querySelectorAll("[data-element]");for(const s of e){t[s.dataset.element]=s}this.subElements=t}render(){const t=document.createElement("div");t.innerHTML=this.getTemplate(),this.element=t.firstElementChild}async add(){const t=await this.loadData();this.products.push(...t),this.components.list.add(t)}async update(){const t=await this.loadData();this.products=[...t],this.components.list.update(t)}registerObserverEvent(t,e){const s=this.observer.subscribe(t,e);this.subscriptions.push(s)}registerStoreEvent(t,e){const s=this.store.subscribe(t,e);this.subscriptions.push(s)}initEventListeners(){this.registerObserverEvent("load-data",(t=>{const{start:e,end:s}=t;this.url.addPagination(e,s),this.add()})),this.registerObserverEvent("add-to-wishlist",(t=>{const{status:e,product:s}=t,{title:i}=s,n=e?"added":"removed";this.notificationManager.show(`Product "${i}" was successfully ${n} to wishlist`,"info")})),this.registerObserverEvent("add-to-cart",(t=>{const{status:e,product:s}=t,{title:i}=s,n=e?"added":"removed";this.notificationManager.show(`Product "${i}" was successfully ${n} to cart`,"info")})),this.registerObserverEvent("search-filter",(t=>{this.url.resetSearchParams().addSearch(t),this.update()})),this.registerObserverEvent("range-selected",(t=>{const{from:e,to:s}=t;this.url.resetSearchParams().addFilter(e,s),this.update()})),this.subElements.gridBtn.addEventListener("pointerdown",(t=>{this.components.list.remove();const e=new o.Z(this.products);this.components.list=new h(e,{step:this.pageSize}),this.subElements.list.innerHTML="",this.subElements.list.append(this.components.list.element)})),this.subElements.listBtn.addEventListener("pointerdown",(t=>{this.components.list.remove();const e=new m([{id:"images",title:"Image",sortable:!1,template:t=>`\n              <td class="col">\n                <img class="sortable-table-image" alt="Image" src="${t[0].url}">\n              </td>`},{id:"rating",title:"rating",sortable:!0,sortType:"number"},{id:"price",title:"Price",sortable:!0,sortType:"number"},{id:"title",title:"Title",sortable:!0,sortType:"string"},{id:"description",title:"Description",sortable:!0,sortType:"string",template:t=>`\n              <td class="col">\n                ${t.slice(0,50)+"..."}\n              </td>`}],{data:this.products});this.components.list=new h(e,{step:this.pageSize}),this.subElements.list.innerHTML="",this.subElements.list.append(this.components.list.element)}))}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null;for(const t of Object.values(this.components))t.destroy&&t.destroy();this.notificationManager.destroy(),this.subscriptions=[]}}))}}]);